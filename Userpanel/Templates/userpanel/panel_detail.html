<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>پنل {{ panel.user.email }}</title>
</head>
<body>
    <h1>پنل کاربری {{ panel.user.email }}</h1>

    <p><strong>نقش:</strong> {{ panel.user.role }}</p>
    <p><strong>نام:</strong> {{ panel.user.first_name|default:"" }} {{ panel.user.last_name|default:"" }}</p>
    <p><strong>شرکت:</strong> {{ panel.user.company_name|default:"-" }}</p>

    <hr>

    {% if is_manager %}
        <h2>آگهی‌های شغلی این مدیر / شرکت</h2>

        {% if job_offers %}
            <table border="1" cellpadding="8">
                <thead>
                    <tr>
                        <th>عنوان شغل</th>
                        <th>دسته‌بندی</th>
                        <th>نوع همکاری</th>
                        <th>وضعیت</th>
                        <th>تاریخ ایجاد</th>
                    </tr>
                </thead>
                <tbody>
                    {% for offer in job_offers %}
                        <tr>
                            <td>{{ offer.job_position.name }}</td>
                            <td>{{ offer.job_category.name|default:"-" }}</td>
                            <td>{{ offer.get_cooperation_type_display }}</td>
                            <td>{{ offer.get_status_display }}</td>
                            <td>{{ offer.created_at|date:"Y-m-d" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>هیچ آگهی‌ای برای این شرکت ثبت نشده است.</p>
        {% endif %}

        <hr>

        <h2>همهٔ درخواست‌های شغلی برای آگهی‌های این شرکت</h2>
        {% if job_requests %}
            <table border="1" cellpadding="8">
                <thead>
                    <tr>
                        <th>متقاضی</th>
                        <th>پوزیشن</th>
                        <th>حقوق درخواستی</th>
                        <th>وضعیت</th>
                        <th>بررسی</th>
                        <th>تاریخ ثبت</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in job_requests %}
                        <tr>
                            <td>{{ r.employee_first_name }} {{ r.employee_last_name }}</td>
                            <td>
                                {% if r.job_position %}
                                    {{ r.job_position.name }}
                                {% else %}
                                    {{ r.job_offer.job_position.name }}
                                {% endif %}
                            </td>
                            <td>{{ r.requested_salary }}</td>
                            <td>{{ r.get_status_display }}</td>
                            <td>{{ r.get_request_check_display }}</td>
                            <td>{{ r.created_at|date:"Y-m-d H:i" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>هیچ درخواست شغلی برای آگهی‌های این شرکت ثبت نشده است.</p>
        {% endif %}

    {% else %}
        <h2>درخواست‌های شغلی این کاربر (کارمند)</h2>

        {% if job_requests %}
            <table border="1" cellpadding="8">
                <thead>
                    <tr>
                        <th>پوزیشن</th>
                        <th>شرکت</th>
                        <th>حقوق درخواستی</th>
                        <th>وضعیت</th>
                        <th>بررسی</th>
                        <th>تاریخ ثبت</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in job_requests %}
                        <tr>
                            <td>
                                {% if r.job_position %}
                                    {{ r.job_position.name }}
                                {% else %}
                                    {{ r.job_offer.job_position.name }}
                                {% endif %}
                            </td>
                            <td>{{ r.company_name }}</td>
                            <td>{{ r.requested_salary }}</td>
                            <td>{{ r.get_status_display }}</td>
                            <td>{{ r.get_request_check_display }}</td>
                            <td>{{ r.created_at|date:"Y-m-d H:i" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>این کاربر هنوز هیچ درخواست شغلی ثبت نکرده است.</p>
        {% endif %}
    {% endif %}

    <hr>

    <p>
        <a href="{% url 'userpanel:panel_list' %}">بازگشت به لیست پنل‌ها</a>
    </p>
</body>
</html>
